<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Journal de Trading</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Pour les icônes du bouton de thème -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Lier vos fichiers CSS -->
  <script type="module" crossorigin src="/Site-de-rapport-de-trade/assets/index-rtIZ7uvd.js"></script>
  <link rel="stylesheet" crossorigin href="/Site-de-rapport-de-trade/assets/index-CQxAarrz.css">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Barre de navigation latérale -->
            <nav class="col-md-2 d-none d-md-block sidebar" id="main-sidebar">
                <div class="position-sticky pt-3">
                    <h4 class="text-center my-4">Mon Journal de Trading</h4>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="#" data-section="dashboard">Tableau de Bord</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-section="open-positions">Positions Ouvertes</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-section="trade-history">Historique des Positions</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-section="reports-analytics">Rapports & Statistiques</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-section="account-management">Gestion du Compte</a></li>
                    </ul>
                    <hr>
                
                    <div class="text-center px-3">
                        <p id="user-display" class="text-light small"></p>
                        <button class="btn btn-outline-light btn-sm mb-2" id="logout-btn">Déconnexion</button>
                        <button class="btn btn-outline-light btn-sm" id="theme-toggle-btn"><i class="bi bi-sun-fill"></i></button>
                    </div>

                </div>
            </nav>

            <!-- Contenu principal -->
            <main class="col-md-10 ms-sm-auto col-lg-10 px-md-4" id="main-content-area">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2" id="section-title">Chargement...</h1>
                </div>

                <!-- Section d'Authentification -->
                <section id="auth-section" class="content-section">
                    <h2>Connexion / Inscription</h2>
                    <div id="auth-error-message" class="alert alert-danger d-none mt-3" role="alert"></div>
                    <form id="login-form" class="mb-4 mt-4">
                        <h4 class="mb-3">Se connecter</h4>
                        <div class="mb-3"><label for="loginEmail" class="form-label">Email</label><input type="email" class="form-control" id="loginEmail" required></div>
                        <div class="mb-3"><label for="loginPassword" class="form-label">Mot de passe</label><input type="password" class="form-control" id="loginPassword" required></div>
                        <button type="submit" class="btn btn-primary">Se connecter</button>
                    </form>
                    <hr>
                    <form id="signup-form">
                        <h4 class="mb-3">Créer un compte</h4>
                        <div class="mb-3"><label for="signupEmail" class="form-label">Email</label><input type="email" class="form-control" id="signupEmail" required></div>
                        <div class="mb-3"><label for="signupPassword" class="form-label">Mot de passe</label><input type="password" class="form-control" id="signupPassword" required><div class="form-text">Minimum 6 caractères.</div></div>
                        <button type="submit" class="btn btn-success">S'inscrire</button>
                    </form>
                </section>

                <!-- Section Tableau de Bord -->
<section id="dashboard" class="content-section">
    <div class="row">
        <div class="col-xl-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header">Courbe de Performance Cumulative</div>
                <div class="card-body">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-xl-4">
            <div class="card shadow-sm mb-4">
                <div class="card-header">Statistiques Clés</div>
                <div class="card-body">
                    <h5>Profit/Perte Net Total</h5>
                    <div class="h3" id="total-profit-loss">
                    <hr>
                    <h5>Taux de Réussite</h5>
                    <p class="h3" id="win-rate">0%</p>
                    <hr>
                    <h5>Positions Clôturées</h5>
                    <p class="h3" id="total-trades">0</p>
                </div>
            </div>
        </div>
    </div>
    <div class="card shadow-sm">
        <div class="card-header">Dernières Positions Clôturées</div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Date Clôture</th>
                            <th>Actif</th>
                            <th>Type</th>
                            <th>P/L Réalisé</th>
                        </tr>
                    </thead>
                    <tbody id="last-trades-body">
                        <!-- Données insérées par JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>
                
                <!-- Section Positions Ouvertes -->
                <section id="open-positions" class="content-section">
                    
                    <button id="show-new-position-form-btn" class="btn btn-primary mb-3">Ouvrir une Nouvelle Position</button>
                    <div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>Actif</th><th>Type</th><th>Quantité</th><th>Prix d'Entrée Moyen</th><th>Valeur Actuelle</th><th>Actions</th></tr></thead><tbody id="open-positions-body"></tbody></table></div>
                </section>

                <!-- Section Historique -->
                <section id="trade-history" class="content-section">
    
    
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Ouverture</th>
                    <th>Clôture</th>
                    <th>Actif</th>
                    <th>Type</th>
                    <th>Entrée Moy.</th>
                    <th>Sortie Moy.</th>
                    <th>P/L Réalisé</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="all-trades-body"></tbody>
        </table>
    </div> <!-- La div se termine ICI -->

    <!-- La navigation est MAINTENANT à l'extérieur -->
    <nav class="mt-3 d-flex justify-content-between align-items-center">
        <div>
            <span id="pagination-info">Page 1 sur 1</span>
        </div>
        <div>
            <button class="btn btn-outline-secondary" id="prev-page-btn" disabled>Précédent</button>
            <button class="btn btn-outline-secondary" id="next-page-btn" disabled>Suivant</button>
        </div>
    </nav>
</section>
                
                <!-- Autres sections (vides pour l'instant pour simplifier) -->
              <section id="reports-analytics" class="content-section">
    
    
    <!-- PREMIÈRE RANGÉE DE 3 GRAPHIQUES -->
    <div class="row mt-4">
        <!-- Graphique 1 : P&L Mensuel -->
        <div class="col-lg-4 mb-3">
            <div class="card shadow-sm h-100"> <!-- h-100 pour que toutes les cartes aient la même hauteur -->
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>P/L par Mois</span>
                    <div class="year-navigator">
                        <button class="btn btn-outline-secondary btn-sm" id="pnl-prev-year">‹</button>
                        <strong id="pnl-current-year" class="mx-2">2024</strong>
                        <button class="btn btn-outline-secondary btn-sm" id="pnl-next-year">›</button>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="monthlyPnLChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Graphique 2 : Activité Mensuelle -->
        <div class="col-lg-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Activité Mensuelle</span>
                    <div class="year-navigator">
                        <button class="btn btn-outline-secondary btn-sm" id="activity-prev-year">‹</button>
                        <strong id="activity-current-year" class="mx-2">2024</strong>
                        <button class="btn btn-outline-secondary btn-sm" id="activity-next-year">›</button>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="monthlyActivityChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Graphique 3 : Taux de Réussite par Actif -->
        <div class="col-lg-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-header">Taux de Réussite par Actif</div>
                <div class="card-body">
                    <canvas id="winRateByAssetChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- DEUXIÈME RANGÉE DE 3 GRAPHIQUES (avec un espace vide pour le moment) -->
    <div class="row mt-4">
        <!-- Graphique 4 : Performance par Type -->
        <div class="col-lg-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-header">Performance par Type (Long vs Short)</div>
                <div class="card-body d-flex flex-column justify-content-between"> <!-- Flexbox pour bien aligner -->
                    <canvas id="longShortPnlChart" style="max-height: 150px;"></canvas>
                    <div id="longShortStatsDisplay" class="mt-3">
                        <!-- Stats ici -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Graphique 5 : Gains vs Pertes Moyennes -->
        <div class="col-lg-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-header">Gains vs. Pertes Moyennes</div>
                <div class="card-body d-flex flex-column justify-content-between">
                    <canvas id="avgWinLossChart" style="max-height: 150px;"></canvas>
                    <div id="avgWinLossStatsDisplay" class="mt-3 text-center">
                        <!-- Stats ici -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Graphique 6 : Espace réservé pour un futur graphique -->
        <div class="col-lg-4 mb-3">
            <!-- Vous pourrez ajouter un nouveau graphique ici plus tard -->
        </div>
    </div>
</section>
               <section id="account-management" class="content-section">
    <h2>Gestion du Compte</h2>
    <div class="row">
        <!-- Colonne de gauche : Balances et Formulaire -->
        <div class="col-md-5">
            <!-- Affichage des Balances -->
            <div class="card shadow-sm mb-4">
                <div class="card-header">Balances par Devise</div>
                <div class="card-body" id="balances-display">
                    <!-- Les balances seront insérées ici par JS -->
                    <p class="text-muted">Aucune transaction pour le moment.</p>
                </div>
            </div>

            <!-- Formulaire de Transaction -->
            <div class="card shadow-sm">
                <div class="card-header">Nouvelle Transaction</div>
                <div class="card-body">
                    <form id="account-form">
                        <!-- Sélecteur de Type de Transaction -->
                        <div class="mb-3">
                            <label for="transactionType" class="form-label">Type de Transaction</label>
                            <select class="form-select" id="transactionType" required>
                                <option value="deposit">Dépôt</option>
                                <option value="withdrawal">Retrait</option>
                                <option value="conversion">Conversion de Devise</option>
                            </select>
                        </div>

                        <!-- Groupe de champs pour Dépôt / Retrait -->
                        <div id="deposit-withdrawal-group">
                            <div class="mb-3">
                                <label for="dw_date" class="form-label">Date</label>
                                <input type="date" class="form-control" id="dw_date">
                            </div>
                            <div class="mb-3">
                                <label for="dw_amount" class="form-label">Montant</label>
                                <input type="number" class="form-control" id="dw_amount" step="0.01">
                            </div>
                            <div class="mb-3">
                                <label for="dw_currency" class="form-label">Devise</label>
                                <input type="text" class="form-control" id="dw_currency" placeholder="Ex: EUR, USD, CHF">
                            </div>
                        </div>

                        <!-- Groupe de champs pour Conversion -->
                        <div id="conversion-group" class="d-none">
                            <div class="mb-3">
                                <label for="conv_date" class="form-label">Date</label>
                                <input type="date" class="form-control" id="conv_date">
                            </div>
                            <hr>
                            <h6>De (Source)</h6>
                            <div class="row">
                                <div class="col"><label for="conv_from_amount">Montant</label><input type="number" id="conv_from_amount" class="form-control" step="0.01"></div>
                                <div class="col"><label for="conv_from_currency">Devise</label><input type="text" id="conv_from_currency" class="form-control" placeholder="EUR"></div>
                            </div>
                            <h6 class="mt-3">Vers (Destination)</h6>
                            <div class="row">
                                <div class="col"><label for="conv_to_currency">Devise</label><input type="text" id="conv_to_currency" class="form-control" placeholder="USD"></div>
                                <div class="col"><label for="conv_rate">Taux de Change</label><input type="number" id="conv_rate" class="form-control" step="0.00001" placeholder="1.07"></div>
                            </div>
                            <p class="mt-2">Vous recevrez (approx.): <strong id="conv_to_amount_display">0.00</strong></p>
                        </div>

                        <button type="submit" class="btn btn-primary mt-3">Enregistrer la Transaction</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Colonne de droite : Historique -->
        <div class="col-md-7">
            <div class="card shadow-sm">
                <div class="card-header">Historique des Transactions de Compte</div>
                <div class="card-body">
                    <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Opération</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-history-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
            </main>
        </div>
    </div>

    <!-- Modale de Gestion de Position -->
    <div class="modal fade" id="positionModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title" id="positionModalLabel"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
            <!-- index.html -> à l'intérieur de la modale -->

<form id="position-form">
    <!-- Champs cachés pour la logique interne -->
    <input type="hidden" id="positionId">
    <input type="hidden" id="formAction">

    <!-- Groupe de champs pour une NOUVELLE position (masqués lors d'une modification) -->
    <div id="new-position-fields">
        <div class="mb-3" id="asset-group">
    <label for="positionAsset" class="form-label">Actif / Instrument</label>
    <!-- MODIFICATION 1 : Ajout de l'attribut list="asset-list" -->
    <input type="text" class="form-control" id="positionAsset" required list="asset-list">
    <!-- MODIFICATION 2 : Ajout de la datalist vide -->
    <datalist id="asset-list"></datalist>
</div>
        <div class="mb-3" id="type-group">
            <label for="positionType" class="form-label">Type de Position</label>
            <select class="form-select" id="positionType" required>
                <option value="long">Achat (Long)</option>
                <option value="short">Vente (Short)</option>
            </select>
        </div>
        <div class="mb-3" id="currency-group">
    <label for="positionCurrency" class="form-label">Devise de la Position</label>
    <!-- MODIFICATION 3 : Ajout de l'attribut list="currency-list" -->
    <input type="text" class="form-control" id="positionCurrency" placeholder="Ex: EUR, USD" required list="currency-list">
    <!-- MODIFICATION 4 : Ajout de la datalist vide -->
    <datalist id="currency-list"></datalist>
</div>
    </div>

    <hr id="transaction-separator"> <!-- Séparateur visuel -->

    <!-- Champs pour TOUTES les opérations (ouverture, renfort, clôture) -->
    <h5 id="transaction-title">Détails de l'Opération</h5>
    <div class="mb-3">
        <label for="transactionDate" class="form-label">Date & Heure</label>
        <input type="datetime-local" class="form-control" id="transactionDate" required>
    </div>
    <div class="mb-3">
        <label for="transactionQuantity" class="form-label">Quantité</label>
        <input type="number" class="form-control" id="transactionQuantity" step="any" placeholder="Ex: 10, 0.5" required>
    </div>
    <div class="mb-3">
        <label for="transactionPrice" class="form-label">Prix</label>
        <input type="number" class="form-control" id="transactionPrice" step="any" placeholder="Ex: 430.50" required>
    </div>
    
    <!-- Champ de notes (uniquement pour l'ouverture) -->
    <div class="mb-3" id="notes-group">
        <label for="positionNotes" class="form-label">Notes (optionnel)</label>
        <textarea class="form-control" id="positionNotes" rows="2"></textarea>
    </div>
</form>
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button><button type="button" class="btn btn-primary" id="save-position-btn">Enregistrer</button></div>
    </div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>